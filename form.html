<!DOCTYPE html>
<html lang="en">

<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Appointment Booking Form</title>
 <style>
  .error {
   color: red;
  }

  .error-field {
   border: 1px solid red;
  }

  #loginformbox {
   width: 500px;
   height: 500px;
   background-color: aquamarine;
  }
 </style>
</head>

<body>

 <form id="appointment-form" action="submit_action.php" method="POST">
  <div>
   <label for="patientName">Patient Name:</label>
   <input type="text" id="patientName" class="appointment-consult-field">
   <span id="patient-box-error" class="error"></span>
  </div>

  <label for="locationBox">Location:</label>
  <select class="appointment-consult-field" required="" name="Location" id="locationBox">
   <option value="" disabled="" selected="">Location</option>
   <option value="Docube Healthcare Koramangala" id="ff80808181b769a70181c3b3906c0dc4">Docube
    Healthcare Koramangala</option>
   <option value="Docube Healthcare Whitefield" id="ff80808186749c930186b6d1b4d40c4b">Docube
    Healthcare Whitefield</option>
  </select>
  <p id="location-box-error" class="error"></p>

  <label for="selectBox">Select Service:</label>
  <select class="appointment-consult-field" required="" name="Service" id="selectBox">
   <option value="" disabled="" selected="">Service</option>
   <option value="For In-Person Consultation" id="ff8080818e11a54a018e50d2234e4017">For In-Person
    Consultation</option>
   <option value="Video Consultation" id="ff8080818e11a560018e50d287dd08d9">Video Consultation</option>
  </select>
  <p id="select-box-error" class="error"></p>
  <div>
   <label for="datebox">Select Date:</label>
   <input type="date" id="datebox" class="appointment-consult-field">
   <span id="date-box-error" class="error"></span>
  </div>
  <div>
   <label for="timeslot">Select Time Slot:</label><br>
   <div id="radiobuttondata" class="radiobuttondata">
    <input class="timeslotinput" type="radio" name="timeslot" id="timeslot-29-03-2024-0" value="5:30 PM" required="">
    <label class="timeslotlabel" for="timeslot-29-03-2024-0">5:30 PM</label>
    <br>
    <input class="timeslotinput" type="radio" name="timeslot" id="timeslot-29-03-2024-1" value="5:45 PM" required="">
    <label class="timeslotlabel" for="timeslot-29-03-2024-1">5:45 PM</label>
    <br><input class="timeslotinput" type="radio" name="timeslot" id="timeslot-29-03-2024-2" value="6:00 PM"
     required=""><label class="timeslotlabel" for="timeslot-29-03-2024-2">6:00 PM</label><br><input
     class="timeslotinput" type="radio" name="timeslot" id="timeslot-29-03-2024-3" value="6:15 PM" required=""><label
     class="timeslotlabel" for="timeslot-29-03-2024-3">6:15 PM</label><br><input class="timeslotinput" type="radio"
     name="timeslot" id="timeslot-29-03-2024-4" value="6:30 PM" required=""><label class="timeslotlabel"
     for="timeslot-29-03-2024-4">6:30 PM</label><br><input class="timeslotinput" type="radio" name="timeslot"
     id="timeslot-29-03-2024-5" value="6:45 PM" required=""><label class="timeslotlabel"
     for="timeslot-29-03-2024-5">6:45 PM</label><br><input class="timeslotinput" type="radio" name="timeslot"
     id="timeslot-29-03-2024-6" value="7:00 PM" required=""><label class="timeslotlabel"
     for="timeslot-29-03-2024-6">7:00 PM</label><br><input class="timeslotinput" type="radio" name="timeslot"
     id="timeslot-29-03-2024-7" value="7:15 PM" required=""><label class="timeslotlabel"
     for="timeslot-29-03-2024-7">7:15 PM</label><br>
   </div>
  </div>
  <span id="radio-box-error" class="error"></span>
  <button id="book-appointment-button" type="submit">Book Appointment</button>
 </form>

 <div id="loginformbox" style="display: none;">
  <!-- Your login form content here -->
 </div>

 <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
 <script>
  $(document).ready(function () {
   // Function to clear errors messages
   function clearErrors() {
    $('#patient-box-error, #location-box-error, #select-box-error, #date-box-error').text('');
    $('#radio-box-error').text('');
   }

   // Event listener to clear errors when any input field is focused
   $('input, select').on('input', function () {
    $(this).next('.error').text('');
   });

   var radioButtons = document.querySelectorAll('input[name="timeslot"]');
   var radioForm = document.getElementById("book-appointment-form");

   radioButtons.forEach(function (radioButton) {
    radioButton.addEventListener("change", function () {
     var selectedOption = document.querySelector('input[name="timeslot"]:checked');
     if (!selectedOption) {
      // errorDiv.textContent = "Please select an option";
      $('#radio-box-error').text('Please select a time slot');
     } else {
      errorDiv.textContent = "";
     }
    });
   });

   $(document).on("change", 'input[type="radio"]', function () {
    console.log("print");
    var timeslot = $(".timeslotinput");
    if ($(".timeslotinput").is(":checked")) {
     $("#radio-box-error").text("");
     console.log(timeslot.val());
    }
    console.log(timeslot.val());
   });

   $('#book-appointment-button').click(function (e) {
    e.preventDefault(); // Prevent default form submission

    var errors = false; // Flag to track errors

    var patientname = $('#patientName').val();
    var location = $('#locationBox').val();
    var service = $('#selectBox').val();
    var datebox = $('#datebox').val();
    var storedPhoneNumber = localStorage.getItem('phoneNumber');

    clearErrors(); // Clear any previous errors

    // Validate patient name, location, service, and date
    if (patientname === '') {
     $('#patient-box-error').text('Please enter patient name');
     errors = true;
    }
    if (location === null) {
     console.log("location");
     $('#location-box-error').text('Please select a location'); // Corrected selector
     errors = true;
    }
    console.log("location");
    if (service === null) {
     console.log("service");
     $('#select-box-error').text('Please select a service'); // Corrected selector
     errors = true;
    }
    console.log("service");
    if (datebox === '') {
     $('#date-box-error').text('Please select a date');
     errors = true;
    }

    // Check if all fields are filled and storedPhoneNumber is null
    if (patientname == location) {
     if (!$('.timeslotinput').is(':checked')) {
      $('#radio-box-error').text('Please select a time slot');
      errors = true;
     }


    }


    // Check if all fields are filled and storedPhoneNumber is null
    if (errors === false && storedPhoneNumber === null) {
     $('#loginformbox').css('display', 'block');
     errors = true;
    }

    if (errors === false) {
     // Auto-submit the form here
     $('#appointment-form').submit();
    }
   });
  });

 </script>


 <!-- Review Slider Code -->
 <script>
  $(document).ready(function () {
   $('.doctor-detail-review-collection-list').slick({
    slidesToShow: 1,
    slidesToScroll: 1,
    dots: true,
   });
  });
 </script>

 <script>
  var dateInput = document.getElementById("datebox");
  var messageDiv = document.querySelector(".appointment-time-heading");
  dateInput.addEventListener("change", function () {
   if (dateInput.value !== "") {
    messageDiv.style.display = "block";
   } else { messageDiv.style.display = "none"; }
  });
 </script>
 <!--PageRefreshCode-->
 <script>
  document.getElementById("refreshButton").addEventListener("click", function () {
   location.reload();
  });
  document.getElementById("errorMessage").addEventListener("click", function () {
   location.reload();
  });
 </script>

 <script>
  $(document).ready(function () {
   const employeeId = "{{wf {&quot;path&quot;:&quot;employee-uuid&quot;,&quot;type&quot;:&quot;PlainText&quot;\} }}";
   $('#selectBox').on('change', fetchData);
   var errorMessage = document.getElementById("errorMessage");
   $('#locationBox').on('change', fetchData);
   $('#datebox').on('change', fetchData);
   $("#datebox").datepicker({
    dateFormat: 'dd-mm-yy',
    autoHide: true,
    minDate: 0,
    onClose: function (selectedDates, dateStr, instance) {
     var messageDiv = document.querySelector(".appointment-time-heading");
     if (dateStr !== "") {
      messageDiv.style.display = "block";
     } else {
      messageDiv.style.display = "none";
     }
    }
   });
   function fetchData() {
    const selectBox = document.getElementById('selectBox');
    const locationBox = document.getElementById('locationBox');
    const appointmentDate = $('#datebox').datepicker('getDate');
    const selectedLocationId = locationBox.options[locationBox.selectedIndex].id;
    const selectedServiceId = selectBox.options[selectBox.selectedIndex].id;
    if (selectedLocationId && selectedServiceId && appointmentDate) {
     const startDate = formatDate(appointmentDate);
     const endDate = formatDate(appointmentDate);
     console.log("Employee ID:", employeeId);
     console.log("Service Offering ID:", selectedServiceId);
     console.log("Branch ID:", selectedLocationId);
     console.log("Start Date:", startDate);
     console.log("End Date:", endDate);
     const apiUrl = `https://profile.docube.in/i-api/v1.0/workflow/appointments/getAvailableSlots/?employeeId=${employeeId}&excludeAppointmentId=&branchId=${selectedLocationId}&serviceOfferingId=${encodeURIComponent(selectedServiceId)}&startDate=${startDate}&endDate=${endDate}`;
     fetch(apiUrl)
      .then(response => {
       if (!response.ok) {
        throw new Error('Network response was not ok');
       }
       return response.json();
      })
      .then(data => {
       console.log("API Response:", data);
       if (Object.keys(data).length === 0) {
        const bookappointmentform = document.getElementById("radiobuttondata");
        bookappointmentform.innerHTML = '';
        const noSlotsMessage = document.createElement('p');
        noSlotsMessage.textContent = `No time slots available for the date ${startDate}`;
        bookappointmentform.appendChild(noSlotsMessage);
        $("#radio-box-error").css("display", "none");
       } else {
        displayData(data);
        $("#radio-box-error").css("display", "block");
       }
      })
      .catch(error => {
       console.error("Error fetching data:", error);
       $('#radio-box-error').text("Error fetching data: " + error.message);
      });
    }
   }
   function displayData(data) {
    const bookappointmentform = document.getElementById("radiobuttondata");
    bookappointmentform.innerHTML = '';
    Object.keys(data).forEach(date => {
     const timeSlots = data[date];
     if (timeSlots && timeSlots.length > 0) {
      timeSlots.forEach((slot, index, array) => {
       const hours = Math.floor(slot / 60);
       const minutes = slot % 60;
       const formattedTime = hours * 60 + minutes;
       const radioId = `timeslot-${date}-${index}`;
       const radioInput = document.createElement('input');
       radioInput.className = 'timeslotinput';
       radioInput.type = 'radio';
       radioInput.name = 'timeslot';
       radioInput.id = radioId;
       radioInput.value = formattedTime;
       radioInput.required = true;
       const label = document.createElement('label');
       label.className = 'timeslotlabel';
       label.textContent = formatTime(slot);
       label.setAttribute('for', radioId);
       const containerDiv = document.createElement('div');
       containerDiv.className = 'input-label-container'; // add a class if needed
       containerDiv.appendChild(radioInput);
       containerDiv.appendChild(label);
       bookappointmentform.appendChild(containerDiv);
      });
     } else {
      const noSlotsMessage = document.createElement('p');
      noSlotsMessage.textContent = `No time slots available for the date ${date}`;
      bookappointmentform.appendChild(noSlotsMessage);
     }
    });
   }
   function formatDate(date) {
    const d = new Date(date);
    const year = d.getFullYear();
    const month = String(d.getMonth() + 1).padStart(2, '0');
    const day = String(d.getDate()).padStart(2, '0');
    return `${day}-${month}-${year}`;
   }
   function formatTime(minutes) {
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    const ampm = hours >= 12 ? 'PM' : 'AM';
    const formattedHours = hours % 12 || 12;
    return `${formattedHours}:${mins.toString().padStart(2, '0')} ${ampm}`;
   }

   document.getElementById("book-appointment-form").addEventListener("submit", function (event) {
    event.preventDefault(); // Prevent default form submission behavior
    var selectedTimeSlot = document.querySelector('input[name="timeslot"]:checked').value;
    console.log(selectedTimeSlot);
    setTimeout(function () {
     setAppointment(selectedTimeSlot);
    }, 7000);
   });
   function setAppointment(selectedTimeSlot) {
    const selectBox = document.getElementById('selectBox');
    const locationBox = document.getElementById('locationBox');
    const selectedLocationId = locationBox.options[locationBox.selectedIndex].id;
    const selectedServiceId = selectBox.options[selectBox.selectedIndex].id;
    const patientId = localStorage.getItem('uuid');
    fetch('https://api.continuouscare.in/e-api/v1.0/workflow/appointments/setAppointment', {
     method: 'POST',
     headers: {
      'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlaWQiOjI1NzExLCJ1aWQiOjQ5NDg5OCwiYXVkIjpbImNjX2FwaSJdLCJjdWlkIjpudWxsLCJldWlkIjoiYjRhNWQ3MjEtN2UzYS00MDQ4LThhODYtZTFmMjkyYmU4YzVmIiwib3VpZCI6IjI5ODE0MWFhLTE0ZjgtNDViYi05YjdkLTM5NTczMzJjOGZiNCIsInVzZXJfbmFtZSI6IiR1c2VySWQ6NDk0ODk4I3R5cGU6RU1QTE9ZRUUiLCJzY29wZSI6WyJFTVBMT1lFRSJdLCJ1dWlkIjoiNzVmNDJlYjItNTc5ZC00NGNmLWJiOTUtZjBiNWZkOTk5NjJhIiwianRpIjoiYTdiYWZjNzMtMWEyZC00MzJmLTllMDQtM2JmZmE3ZDU2YWM5IiwiY2xpZW50X2lkIjoicHJvdmlkZXJfd2ViIiwiY2lkIjpudWxsfQ.phlFjN6PW4hNeLDVZPdbVOGkYx8rOZcr0pNK5eip830',
      'Content-Type': 'application/json',
      'Cookie': 'AWSALB=ee+XsdR9tTEcuqKbBvtJUR3SeLL0YZCz6AA4+21gMYWyGIH73olZmW+OaiSzDqCuwIr5DxGqbHAnPIlHrMKeYSFrfKgqGKZkrC1KAPFkS5y2jWTo370hT/OdP58A; AWSALBCORS=ee+XsdR9tTEcuqKbBvtJUR3SeLL0YZCz6AA4+21gMYWyGIH73olZmW+OaiSzDqCuwIr5DxGqbHAnPIlHrMKeYSFrfKgqGKZkrC1KAPFkS5y2jWTo370hT/OdP58A; SESSION=417e6ca9-82e2-4cae-8515-03a08b0c8a90'
     },
     body: JSON.stringify({
      "orgId": "298141aa14f845bb9b7d3957332c8fb4",
      "branchId": selectedLocationId,
      "date": formatDate($('#datebox').datepicker('getDate')),
      "participant": [{
       "actor": {
        "type": "PATIENT",
        "id": patientId
       }
      },
      {
       "actor": {
        "type": "PROVIDER",
        "id": employeeId
       }
      }
      ],
      "appointmentTime": parseInt(selectedTimeSlot),
      "serviceId": selectedServiceId,
      "timezoneOffsetInMins": "330",
      "makeAppointmentFree": "false"
     })
    })
     .then(response => response.json())
     .then(data => {
      console.log({
       "orgId": "298141aa14f845bb9b7d3957332c8fb4",
       "branchId": selectedLocationId,
       "date": formatDate($('#datebox').datepicker('getDate')),
       "participant": [{
        "actor": {
         "type": "PATIENT",
         "id": patientId
        }
       },
       {
        "actor": {
         "type": "PROVIDER",
         "id": employeeId
        }
       }
       ],
       "appointmentTime": parseInt(selectedTimeSlot),
       "serviceId": selectedServiceId,
       "timezoneOffsetInMins": "330",
       "makeAppointmentFree": "false"
      });
      console.log(data);
      let htmlContent = '';
      for (const [key, value] of Object.entries(data)) {
       htmlContent += `<p><strong>${key}:</strong> ${value}</p>`;
      }
     })
     .catch(error => {
      console.error('Error fetching data:', error);
      errorMessage.style.display = "block"; // Display error message
      $('#radio-box-error').text("Error fetching data: " + error.message); // Set error message text
     });
   }
  });
 </script>


 <!-- Review Slider Code -->
 <script>
  $(document).ready(function () {
   $('.doctor-detail-review-collection-list').slick({
    slidesToShow: 1,
    slidesToScroll: 1,
    dots: true,
   });
  });
 </script>
 <script>
  var dateInput = document.getElementById("datebox");
  var messageDiv = document.querySelector(".appointment-time-heading");
  dateInput.addEventListener("change", function () {
   if (dateInput.value !== "") {
    messageDiv.style.display = "block";
   } else { messageDiv.style.display = "none"; }
  });
 </script>
 <!--PageRefreshCode-->
 <script>
  document.getElementById("refreshButton").addEventListener("click", function () {
   location.reload();
  });
  document.getElementById("errorMessage").addEventListener("click", function () {
   location.reload();
  });
 </script>

 <script>
  $(document).ready(function () {
   const employeeId = "{{wf {&quot;path&quot;:&quot;employee-uuid&quot;,&quot;type&quot;:&quot;PlainText&quot;\} }}";
   $('#selectBox').on('change', fetchData);
   var errorMessage = document.getElementById("errorMessage");
   $('#locationBox').on('change', fetchData);
   $('#datebox').on('change', fetchData);
   $("#datebox").datepicker({
    dateFormat: 'dd-mm-yy',
    autoHide: true,
    minDate: 0,
    onClose: function (selectedDates, dateStr, instance) {
     var messageDiv = document.querySelector(".appointment-time-heading");
     if (dateStr !== "") {
      messageDiv.style.display = "block";
     } else {
      messageDiv.style.display = "none";
     }
    }
   });
   function fetchData() {
    const selectBox = document.getElementById('selectBox');
    const locationBox = document.getElementById('locationBox');
    const appointmentDate = $('#datebox').datepicker('getDate');
    const selectedLocationId = locationBox.options[locationBox.selectedIndex].id;
    const selectedServiceId = selectBox.options[selectBox.selectedIndex].id;
    if (selectedLocationId && selectedServiceId && appointmentDate) {
     const startDate = formatDate(appointmentDate);
     const endDate = formatDate(appointmentDate);
     console.log("Employee ID:", employeeId);
     console.log("Service Offering ID:", selectedServiceId);
     console.log("Branch ID:", selectedLocationId);
     console.log("Start Date:", startDate);
     console.log("End Date:", endDate);
     const apiUrl = `https://profile.docube.in/i-api/v1.0/workflow/appointments/getAvailableSlots/?employeeId=${employeeId}&excludeAppointmentId=&branchId=${selectedLocationId}&serviceOfferingId=${encodeURIComponent(selectedServiceId)}&startDate=${startDate}&endDate=${endDate}`;
     fetch(apiUrl)
      .then(response => {
       if (!response.ok) {
        throw new Error('Network response was not ok');
       }
       return response.json();
      })
      .then(data => {
       console.log("API Response:", data);
       if (Object.keys(data).length === 0) {
        const bookappointmentform = document.getElementById("radiobuttondata");
        bookappointmentform.innerHTML = '';
        const noSlotsMessage = document.createElement('p');
        noSlotsMessage.textContent = `No time slots available for the date ${startDate}`;
        bookappointmentform.appendChild(noSlotsMessage);
        $("#radio-box-error").css("display", "none");
       } else {
        displayData(data);
        $("#radio-box-error").css("display", "block");
       }
      })
      .catch(error => {
       console.error("Error fetching data:", error);
       $('#radio-box-error').text("Error fetching data: " + error.message);
      });
    }
   }
   function displayData(data) {
    const bookappointmentform = document.getElementById("radiobuttondata");
    bookappointmentform.innerHTML = '';
    Object.keys(data).forEach(date => {
     const timeSlots = data[date];
     if (timeSlots && timeSlots.length > 0) {
      timeSlots.forEach((slot, index, array) => {
       const hours = Math.floor(slot / 60);
       const minutes = slot % 60;
       const formattedTime = hours * 60 + minutes;
       const radioId = `timeslot-${date}-${index}`;
       /*const radioInput = document.createElement('input');
       radioInput.className = 'timeslotinput';
       radioInput.type = 'radio';
       radioInput.name = 'timeslot';
       radioInput.id = radioId;
       radioInput.value = formattedTime;
       radioInput.required = true;
       const label = document.createElement('label');
       label.className = 'timeslotlabel';
       label.textContent = formatTime(slot);
       label.setAttribute('for', radioId);
       //const lineBreak = document.createElement('br');
       bookappointmentform.appendChild(radioInput);
       bookappointmentform.appendChild(label);
       //bookappointmentform.appendChild(lineBreak);*/
       const radioInput = document.createElement('input');
       radioInput.className = 'timeslotinput';
       radioInput.type = 'radio';
       radioInput.name = 'timeslot';
       radioInput.id = radioId;
       radioInput.value = formattedTime;
       radioInput.required = true;

       const label = document.createElement('label');
       label.className = 'timeslotlabel';
       label.textContent = formatTime(slot);
       label.setAttribute('for', radioId);

       const containerDiv = document.createElement('div');
       containerDiv.className = 'input-label-container'; // add a class if needed
       containerDiv.appendChild(radioInput);
       containerDiv.appendChild(label);

       bookappointmentform.appendChild(containerDiv);

      });
     } else {
      const noSlotsMessage = document.createElement('p');
      noSlotsMessage.textContent = `No time slots available for the date ${date}`;
      bookappointmentform.appendChild(noSlotsMessage);
     }
    });
   }
   function formatDate(date) {
    const d = new Date(date);
    const year = d.getFullYear();
    const month = String(d.getMonth() + 1).padStart(2, '0');
    const day = String(d.getDate()).padStart(2, '0');
    return `${day}-${month}-${year}`;
   }
   function formatTime(minutes) {
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    const ampm = hours >= 12 ? 'PM' : 'AM';
    const formattedHours = hours % 12 || 12;
    return `${formattedHours}:${mins.toString().padStart(2, '0')} ${ampm}`;
   }
   /*
   $('#book-appointment-form').submit(function (event) {
          var phoneNumber = localStorage.getItem('phoneNumber');
     if(phoneNumber){
         changeType();	
   }
       event.preventDefault(); // Prevent default form submission behavior
       const selectedTimeSlot = $('input[name="timeslot"]:checked').val();
       console.log(selectedTimeSlot);
       setTimeout(function () {
           setAppointment(selectedTimeSlot);
       }, 7000);
       
 
   });*/

   document.getElementById("book-appointment-form").addEventListener("submit", function (event) {

    event.preventDefault(); // Prevent default form submission behavior
    var selectedTimeSlot = document.querySelector('input[name="timeslot"]:checked').value;
    console.log(selectedTimeSlot);
    setTimeout(function () {
     setAppointment(selectedTimeSlot);
    }, 7000);
   });        /*var phoneNumber = localStorage.getItem('phoneNumber');
         if (phoneNumber) {
             changeType();
         }*/

   function setAppointment(selectedTimeSlot) {
    const selectBox = document.getElementById('selectBox');
    const locationBox = document.getElementById('locationBox');
    const selectedLocationId = locationBox.options[locationBox.selectedIndex].id;
    const selectedServiceId = selectBox.options[selectBox.selectedIndex].id;
    const patientId = localStorage.getItem('uuid');
    fetch('https://api.continuouscare.in/e-api/v1.0/workflow/appointments/setAppointment', {
     method: 'POST',
     headers: {
      'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlaWQiOjI1NzExLCJ1aWQiOjQ5NDg5OCwiYXVkIjpbImNjX2FwaSJdLCJjdWlkIjpudWxsLCJldWlkIjoiYjRhNWQ3MjEtN2UzYS00MDQ4LThhODYtZTFmMjkyYmU4YzVmIiwib3VpZCI6IjI5ODE0MWFhLTE0ZjgtNDViYi05YjdkLTM5NTczMzJjOGZiNCIsInVzZXJfbmFtZSI6IiR1c2VySWQ6NDk0ODk4I3R5cGU6RU1QTE9ZRUUiLCJzY29wZSI6WyJFTVBMT1lFRSJdLCJ1dWlkIjoiNzVmNDJlYjItNTc5ZC00NGNmLWJiOTUtZjBiNWZkOTk5NjJhIiwianRpIjoiYTdiYWZjNzMtMWEyZC00MzJmLTllMDQtM2JmZmE3ZDU2YWM5IiwiY2xpZW50X2lkIjoicHJvdmlkZXJfd2ViIiwiY2lkIjpudWxsfQ.phlFjN6PW4hNeLDVZPdbVOGkYx8rOZcr0pNK5eip830',
      'Content-Type': 'application/json',
      'Cookie': 'AWSALB=ee+XsdR9tTEcuqKbBvtJUR3SeLL0YZCz6AA4+21gMYWyGIH73olZmW+OaiSzDqCuwIr5DxGqbHAnPIlHrMKeYSFrfKgqGKZkrC1KAPFkS5y2jWTo370hT/OdP58A; AWSALBCORS=ee+XsdR9tTEcuqKbBvtJUR3SeLL0YZCz6AA4+21gMYWyGIH73olZmW+OaiSzDqCuwIr5DxGqbHAnPIlHrMKeYSFrfKgqGKZkrC1KAPFkS5y2jWTo370hT/OdP58A; SESSION=417e6ca9-82e2-4cae-8515-03a08b0c8a90'
     },
     body: JSON.stringify({
      "orgId": "298141aa14f845bb9b7d3957332c8fb4",
      "branchId": selectedLocationId,
      "date": formatDate($('#datebox').datepicker('getDate')),
      "participant": [{
       "actor": {
        "type": "PATIENT",
        "id": patientId
       }
      },
      {
       "actor": {
        "type": "PROVIDER",
        "id": employeeId
       }
      }
      ],
      "appointmentTime": parseInt(selectedTimeSlot),
      "serviceId": selectedServiceId,
      "timezoneOffsetInMins": "330",
      "makeAppointmentFree": "false"
     })
    })
     .then(response => response.json())
     .then(data => {
      console.log({
       "orgId": "298141aa14f845bb9b7d3957332c8fb4",
       "branchId": selectedLocationId,
       "date": formatDate($('#datebox').datepicker('getDate')),
       "participant": [{
        "actor": {
         "type": "PATIENT",
         "id": patientId
        }
       },
       {
        "actor": {
         "type": "PROVIDER",
         "id": employeeId
        }
       }
       ],
       "appointmentTime": parseInt(selectedTimeSlot),
       "serviceId": selectedServiceId,
       "timezoneOffsetInMins": "330",
       "makeAppointmentFree": "false"
      });
      console.log(data);
      let htmlContent = '';
      for (const [key, value] of Object.entries(data)) {
       htmlContent += `<p><strong>${key}:</strong> ${value}</p>`;
      }
     })
     .catch(error => {
      console.error('Error fetching data:', error);
      errorMessage.style.display = "block"; // Display error message
      $('#radio-box-error').text("Error fetching data: " + error.message); // Set error message text
     });
   }
  });
 </script>



</body>

</html>



<!-- Review Slider Code -->
<script>
$(document).ready(function () {
 
 $('.doctor-detail-review-collection-list').slick({
  slidesToShow: 1,
  slidesToScroll: 1,
  dots: true,
 });
});
</script>

<script>
var dateInput = document.getElementById("datebox");
var messageDiv = document.querySelector(".appointment-time-heading");
dateInput.addEventListener("change", function () {
 if (dateInput.value !== "") {
  messageDiv.style.display = "block";
 } else { messageDiv.style.display = "none"; }
});
</script>
<!--PageRefreshCode-->
<script>
document.getElementById("refreshButton").addEventListener("click", function () {
 location.reload();
});
document.getElementById("errorMessage").addEventListener("click", function () {
 location.reload();
});
</script>

<script>
$(document).ready(function () {
 const employeeId = "{{wf {&quot;path&quot;:&quot;employee-uuid&quot;,&quot;type&quot;:&quot;PlainText&quot;\} }}";
 $('#selectBox').on('change', fetchData);
 var errorMessage = document.getElementById("errorMessage");
 $('#locationBox').on('change', fetchData);
 $('#datebox').on('change', fetchData);
 $("#datebox").datepicker({
  dateFormat: 'dd-mm-yy',
  autoHide: true,
  minDate: 0,
  onClose: function (selectedDates, dateStr, instance) {
   var messageDiv = document.querySelector(".appointment-time-heading");
   if (dateStr !== "") {
    messageDiv.style.display = "block";
   } else {
    messageDiv.style.display = "none";
   }
  }
 });
 function fetchData() {
  const selectBox = document.getElementById('selectBox');
  const locationBox = document.getElementById('locationBox');
  const appointmentDate = $('#datebox').datepicker('getDate');
  const selectedLocationId = locationBox.options[locationBox.selectedIndex].id;
  const selectedServiceId = selectBox.options[selectBox.selectedIndex].id;
  if (selectedLocationId && selectedServiceId && appointmentDate) {
   const startDate = formatDate(appointmentDate);
   const endDate = formatDate(appointmentDate);
   console.log("Employee ID:", employeeId);
   console.log("Service Offering ID:", selectedServiceId);
   console.log("Branch ID:", selectedLocationId);
   console.log("Start Date:", startDate);
   console.log("End Date:", endDate);
   const apiUrl = `https://profile.docube.in/i-api/v1.0/workflow/appointments/getAvailableSlots/?employeeId=${employeeId}&excludeAppointmentId=&branchId=${selectedLocationId}&serviceOfferingId=${encodeURIComponent(selectedServiceId)}&startDate=${startDate}&endDate=${endDate}`;
   fetch(apiUrl)
    .then(response => {
     if (!response.ok) {
      throw new Error('Network response was not ok');
     }
     return response.json();
    })
    .then(data => {
     console.log("API Response:", data);
     if (Object.keys(data).length === 0) {
      const bookappointmentform = document.getElementById("radiobuttondata");
      bookappointmentform.innerHTML = '';
      const noSlotsMessage = document.createElement('p');
      noSlotsMessage.textContent = `No time slots available for the date ${startDate}`;
      bookappointmentform.appendChild(noSlotsMessage);
      $("#radio-box-error").css("display", "none");
     } else {
      displayData(data);
      $("#radio-box-error").css("display", "block");
     }
    })
    .catch(error => {
     console.error("Error fetching data:", error);
     $('#radio-box-error').text("Error fetching data: " + error.message);
    });
  }
 }
 function displayData(data) {
  const bookappointmentform = document.getElementById("radiobuttondata");
  bookappointmentform.innerHTML = '';
  Object.keys(data).forEach(date => {
   const timeSlots = data[date];
   if (timeSlots && timeSlots.length > 0) {
    timeSlots.forEach((slot, index, array) => {
     const hours = Math.floor(slot / 60);
     const minutes = slot % 60;
     const formattedTime = hours * 60 + minutes;
     const radioId = `timeslot-${date}-${index}`;
     const radioInput = document.createElement('input');
     radioInput.className = 'timeslotinput';
     radioInput.type = 'radio';
     radioInput.name = 'timeslot';
     radioInput.id = radioId;
     radioInput.value = formattedTime;
     radioInput.required = true;

     const label = document.createElement('label');
     label.className = 'timeslotlabel';
     label.textContent = formatTime(slot);
     label.setAttribute('for', radioId);

     const containerDiv = document.createElement('div');
     containerDiv.className = 'input-label-container'; // add a class if needed
     containerDiv.appendChild(radioInput);
     containerDiv.appendChild(label);

     bookappointmentform.appendChild(containerDiv);

    });
   } else {
    const noSlotsMessage = document.createElement('p');
    noSlotsMessage.textContent = `No time slots available for the date ${date}`;
    bookappointmentform.appendChild(noSlotsMessage);
   }
  });
 }
 function formatDate(date) {
  const d = new Date(date);
  const year = d.getFullYear();
  const month = String(d.getMonth() + 1).padStart(2, '0');
  const day = String(d.getDate()).padStart(2, '0');
  return `${day}-${month}-${year}`;
 }
 function formatTime(minutes) {
  const hours = Math.floor(minutes / 60);
  const mins = minutes % 60;
  const ampm = hours >= 12 ? 'PM' : 'AM';
  const formattedHours = hours % 12 || 12;
  return `${formattedHours}:${mins.toString().padStart(2, '0')} ${ampm}`;
 }
 document.getElementById("book-appointment-form").addEventListener("submit", function (event) {

  event.preventDefault(); // Prevent default form submission behavior
  var selectedTimeSlot = document.querySelector('input[name="timeslot"]:checked').value;
  console.log(selectedTimeSlot);
  setTimeout(function () {
   setAppointment(selectedTimeSlot);
  }, 7000);
 });
 function setAppointment(selectedTimeSlot) {
  const selectBox = document.getElementById('selectBox');
  const locationBox = document.getElementById('locationBox');
  const selectedLocationId = locationBox.options[locationBox.selectedIndex].id;
  const selectedServiceId = selectBox.options[selectBox.selectedIndex].id;
  const patientId = localStorage.getItem('uuid');
  fetch('https://api.continuouscare.in/e-api/v1.0/workflow/appointments/setAppointment', {
   method: 'POST',
   headers: {
    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlaWQiOjI1NzExLCJ1aWQiOjQ5NDg5OCwiYXVkIjpbImNjX2FwaSJdLCJjdWlkIjpudWxsLCJldWlkIjoiYjRhNWQ3MjEtN2UzYS00MDQ4LThhODYtZTFmMjkyYmU4YzVmIiwib3VpZCI6IjI5ODE0MWFhLTE0ZjgtNDViYi05YjdkLTM5NTczMzJjOGZiNCIsInVzZXJfbmFtZSI6IiR1c2VySWQ6NDk0ODk4I3R5cGU6RU1QTE9ZRUUiLCJzY29wZSI6WyJFTVBMT1lFRSJdLCJ1dWlkIjoiNzVmNDJlYjItNTc5ZC00NGNmLWJiOTUtZjBiNWZkOTk5NjJhIiwianRpIjoiYTdiYWZjNzMtMWEyZC00MzJmLTllMDQtM2JmZmE3ZDU2YWM5IiwiY2xpZW50X2lkIjoicHJvdmlkZXJfd2ViIiwiY2lkIjpudWxsfQ.phlFjN6PW4hNeLDVZPdbVOGkYx8rOZcr0pNK5eip830',
    'Content-Type': 'application/json',
    'Cookie': 'AWSALB=ee+XsdR9tTEcuqKbBvtJUR3SeLL0YZCz6AA4+21gMYWyGIH73olZmW+OaiSzDqCuwIr5DxGqbHAnPIlHrMKeYSFrfKgqGKZkrC1KAPFkS5y2jWTo370hT/OdP58A; AWSALBCORS=ee+XsdR9tTEcuqKbBvtJUR3SeLL0YZCz6AA4+21gMYWyGIH73olZmW+OaiSzDqCuwIr5DxGqbHAnPIlHrMKeYSFrfKgqGKZkrC1KAPFkS5y2jWTo370hT/OdP58A; SESSION=417e6ca9-82e2-4cae-8515-03a08b0c8a90'
   },
   body: JSON.stringify({
    "orgId": "298141aa14f845bb9b7d3957332c8fb4",
    "branchId": selectedLocationId,
    "date": formatDate($('#datebox').datepicker('getDate')),
    "participant": [{
     "actor": {
      "type": "PATIENT",
      "id": patientId
     }
    },
    {
     "actor": {
      "type": "PROVIDER",
      "id": employeeId
     }
    }
    ],
    "appointmentTime": parseInt(selectedTimeSlot),
    "serviceId": selectedServiceId,
    "timezoneOffsetInMins": "330",
    "makeAppointmentFree": "false"
   })
  })
   .then(response => response.json())
   .then(data => {
    console.log({
     "orgId": "298141aa14f845bb9b7d3957332c8fb4",
     "branchId": selectedLocationId,
     "date": formatDate($('#datebox').datepicker('getDate')),
     "participant": [{
      "actor": {
       "type": "PATIENT",
       "id": patientId
      }
     },
     {
      "actor": {
       "type": "PROVIDER",
       "id": employeeId
      }
     }
     ],
     "appointmentTime": parseInt(selectedTimeSlot),
     "serviceId": selectedServiceId,
     "timezoneOffsetInMins": "330",
     "makeAppointmentFree": "false"
    });
    console.log(data);
    let htmlContent = '';
    for (const [key, value] of Object.entries(data)) {
     htmlContent += `<p><strong>${key}:</strong> ${value}</p>`;
    }
   })
   .catch(error => {
    console.error('Error fetching data:', error);
    errorMessage.style.display = "block"; // Display error message
    $('#radio-box-error').text("Error fetching data: " + error.message); // Set error message text
   });
 }
});
</script>